
# Results of BridgeTests

I compared the results on riscv64 and amd64.

## bridgetest_client

### amd64

```console
$ ./bridgetest_client 
warn:sal.osl:5438:5440:sal/osl/unx/socket.cxx:1570: receive socket [0] failed: EOL
```

### riscv64

```console
$ ./bridgetest_client 
./bridgetest_client: line 1:  4588 Segmentation fault      /home/infinity/gerrit/lo_build/instdir/program/uno.bin -s com.sun.star.test.bridge.BridgeTest -- -u 'uno:socket,host=127.0.0.1,port=2002;urp;test' -env:LO_BUILD_LIB_DIR=file:///home/infinity/gerrit/lo_build/workdir/LinkTarget/Library -env:URE_MORE_SERVICES=file:///home/infinity/gerrit/lo_build/workdir/Rdb/uno_services.rdb -env:URE_MORE_TYPES=file:///home/infinity/gerrit/lo_build/workdir/UnoApiTarget/bridgetest.rdb
```

## bridgetest_server

amd64 and riscv64 behaves in the same way.

```console
$ ./bridgetest_client 
> accepting socket,host=127.0.0.1,port=2002...connection established.warn:sal.osl:4706:4717:sal/osl/unx/socket.cxx:1570: receive socket [0] failed: EOL
warn:binaryurp:4706:4717:binaryurp/source/reader.cxx:124: caught UNO exception 'N3com3sun4star3uno9ExceptionE msg: acc_socket.cxx:SocketConnection::read: error - Success at /home/infinity/gerrit/lo_build/io/source/acceptor/acc_socket.cxx:175'
```

## gdb core file

Debug uno.bin with core file after bridgetest_client crashed on riscv64.

```log
$ gdb -q /home/infinity/Desktop/lo/libreoffice/instdir/program/uno.bin ./core 
Reading symbols from /home/infinity/Desktop/lo/libreoffice/instdir/program/uno.bin...
[New LWP 586716]
[New LWP 586719]
[New LWP 586720]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/riscv64-linux-gnu/libthread_db.so.1".
Core was generated by `/home/infinity/Desktop/lo/libreoffice/instdir/program/uno.bin -s com.sun.star.t'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x0000003fb04558da in com::sun::star::uno::BaseReference::iquery(com::sun::star::uno::XInterface*, com::sun::star::uno::Type const&) () at /home/infinity/Desktop/lo/libreoffice/include/com/sun/star/uno/Reference.hxx:59
59	        Any aRet( pInterface->queryInterface( rType ) );
[Current thread is 1 (Thread 0x3fb0471010 (LWP 586716))]
(gdb) bt
#0  0x0000003fb04558da in com::sun::star::uno::BaseReference::iquery(com::sun::star::uno::XInterface*, com::sun::star::uno::Type const&) () at /home/infinity/Desktop/lo/libreoffice/include/com/sun/star/uno/Reference.hxx:59
#1  0x0000003fb0455de2 in com::sun::star::uno::Reference<com::sun::star::uno::XInterface>::iquery(com::sun::star::uno::XInterface*) () at /home/infinity/Desktop/lo/libreoffice/include/com/sun/star/uno/Reference.hxx:74
#2  0x0000003fb0455a4c in com::sun::star::uno::Reference<com::sun::star::uno::XInterface>::Reference(com::sun::star::uno::XInterface*, com::sun::star::uno::UnoReference_Query) ()
    at /home/infinity/Desktop/lo/libreoffice/include/com/sun/star/uno/Reference.hxx:182
#3  0x0000003fb0454ffc in s_stub_computeObjectIdentifier ()
    at /home/infinity/Desktop/lo/libreoffice/bridges/source/cpp_uno/shared/component.cxx:85
#4  0x0000003fb0c9ff7c in s_environment_invoke_v(_uno_Environment*, _uno_Environment*, void (*)(void**), void**) ()
    at /home/infinity/Desktop/lo/libreoffice/cppu/source/uno/EnvStack.cxx:293
#5  0x0000003fb0ca001c in uno_Environment_invoke_v () at /home/infinity/Desktop/lo/libreoffice/cppu/source/uno/EnvStack.cxx:312
#6  0x0000003fb0ca007c in uno_Environment_invoke () at /home/infinity/Desktop/lo/libreoffice/cppu/source/uno/EnvStack.cxx:321
#7  0x0000003fb04552fa in computeObjectIdentifier ()
    at /home/infinity/Desktop/lo/libreoffice/bridges/source/cpp_uno/shared/component.cxx:114
#8  0x0000003fb0ca3cf6 in defenv_getObjectIdentifier () at /home/infinity/Desktop/lo/libreoffice/cppu/source/uno/lbenv.cxx:449
#9  0x0000003fb0454766 in cpp2unoMapping () at /home/infinity/Desktop/lo/libreoffice/bridges/source/cpp_uno/shared/bridge.cxx:69
#10 0x0000003fb0c982ba in cppu::_map(void*, _typelib_TypeDescriptionReference*, _typelib_TypeDescription*, _uno_Mapping*) ()
    at /home/infinity/Desktop/lo/libreoffice/cppu/source/uno/prim.hxx:50
#11 0x0000003fb0c9c4be in cppu::_copyConstructData(void*, void*, _typelib_TypeDescriptionReference*, _typelib_TypeDescription*, void (*)(void*), _uno_Mapping*) () at /home/infinity/Desktop/lo/libreoffice/cppu/source/uno/copy.hxx:641
#12 0x0000003fb0c9b39e in uno_copyAndConvertData () at /home/infinity/Desktop/lo/libreoffice/cppu/source/uno/data.cxx:235
#13 0x0000003fb0450f10 in (anonymous namespace)::cpp2uno_call(bridges::cpp_uno::shared::CppInterfaceProxy*, _typelib_TypeDescription const*, _typelib_TypeDescriptionReference*, int, _typelib_MethodParameter*, void**, void**, void**, unsigned long*) ()
    at /home/infinity/Desktop/lo/libreoffice/bridges/source/cpp_uno/gcc3_linux_riscv64/cpp2uno.cxx:246
#14 0x0000003fb04517ec in cpp_vtable_call ()
    at /home/infinity/Desktop/lo/libreoffice/bridges/source/cpp_uno/gcc3_linux_riscv64/cpp2uno.cxx:510
#15 0x0000003fb045d70a in privateSnippetExecutor () from /home/infinity/Desktop/lo/libreoffice/instdir/program/libgcc3_uno.so
#16 0x0000003fb041a9fc in bridge_test::performTest(com::sun::star::uno::Reference<com::sun::star::uno::XComponentContext> const&, com::sun::star::uno::Reference<test::testtools::bridgetest::XBridgeTest> const&, bool) ()
    at /home/infinity/Desktop/lo/libreoffice/testtools/source/bridgetest/bridgetest.cxx:397
#17 0x0000003fb04204b0 in bridge_test::(anonymous namespace)::TestBridgeImpl::run(com::sun::star::uno::Sequence<rtl::OUString> const&) () at /home/infinity/Desktop/lo/libreoffice/testtools/source/bridgetest/bridgetest.cxx:1260
#18 0x0000002ad5437230 in sal_main() () at /home/infinity/Desktop/lo/libreoffice/cpputools/source/unoexe/unoexe.cxx:517
#19 0x0000002ad543650a in main () at /home/infinity/Desktop/lo/libreoffice/cpputools/source/unoexe/unoexe.cxx:357
(gdb) l
54	inline XInterface * BaseReference::iquery(
55	    XInterface * pInterface, const Type & rType )
56	{
57	    if (pInterface)
58	    {
59	        Any aRet( pInterface->queryInterface( rType ) );
60	        if (typelib_TypeClass_INTERFACE == aRet.pType->eTypeClass)
61	        {
62	            XInterface * pRet = static_cast< XInterface * >( aRet.pReserved );
63	            aRet.pReserved = NULL;
```

